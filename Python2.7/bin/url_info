#!/usr/bin/env python

import sys
import requests
import json
from argparse import ArgumentParser

parser = ArgumentParser(description='Save url info (html/json) into file')
parser.add_argument('url', help='specify url to get info')
parser.add_argument('file', help='specify file to save info from url')
parser.add_argument('--format', '-f', default='html', help='specify output format (json/html), default is "html"')

args = parser.parse_args()

res = requests.get(args.url)

if res.status_code != 200:
    print("Error talking to url: %s" % res.status_code)
    sys.exit(1)

with open(args.file, 'w') as f:

    if args.format == "json":
        try:
            print(res.json())
            json.dump(res.json(), f)
        except ValueError:
            print("Error: Content is not JSON")
            sys.exit(1)
    else:
        f.write(res.text.encode("UTF-8"))
        print("Content written to '%s'" % args.filename)
