#!/bin/python

import os
import argparse
from subprocess import Popen, PIPE
from sys import exit

parser = argparse.ArgumentParser(description='kill the running process listening on a given port')
parser.add_argument('port_number', type=int, help='the port number to search for')

port = parser.parse_args().port_number

try:
    p1 = Popen(['lsof', '-n', '-i4TCP:%s' % port], stdout=PIPE)
    p2 = Popen(["grep", "LISTEN"], stdin=p1.stdout, stdout=PIPE)
    p1.stdout.close()
    p_data = p2.communicate()[0].split()
    p_pid = int(p_data[1])
    p_name = p_data[-2]
    os.kill(p_pid, 9)
    print("Process '%s' with pid %s has been terminated" % (p_name, p_pid))
except IndexError:
    print("Error: There is no process listening on port %s" % port)
    exit(1)
